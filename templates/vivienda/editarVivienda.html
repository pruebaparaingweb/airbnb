{% extends "layouts/base.html" %}

{% block title %} Editar Vivienda {% endblock %}

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}{% endblock stylesheets %}


{% block content %}
<div class="content">
  <div class="row">
    <div class="col-md-12">
      <div class="card">
        <div class="card-header text-center">
          <h2><b>Editar Vivienda</b></h2>
          {% if error is defined %}
          <h3 style="color: red;"> {{ error }}</h3>
          {% endif %}
        </div>
        <div class="card-body">
          <form class="form-horizontal" role="form" action="" method="post">
            <div class="row">
              <div class="col-md-6">
                <div class="card card-plain">
                  <div class="card-header">
                    <h5 class="card-title">Datos de la Vivienda</h5>
                  </div>
                  <div class="card-body">
                    <div class="form-group">
                      <div class="col-sm-5">
                        Nombre <input type="text" class="form-control" name="inputNombre" id="inputNombre"
                          value="{{ vivienda.nombre }}">
                      </div>
                    </div>
                    <div class="form-group">
                      <div class="col-sm-5">
                        Descripci&oacute;n <input type="text" class="form-control" name="inputDescripcion"
                          id="inputDescripcion" value="{{ vivienda.descripcion }}">
                      </div>
                    </div>
                    <div class="form-group">
                      <div class="col-sm-5">
                        Precio/Noche <input type="number" class="form-control" name="inputPrecio" id="inputPrecio"
                          value="{{ vivienda.precio }}">
                      </div>
                    </div>
                    <div class="form-group">
                      <div class="col-sm-5">
                        Capacidad <input type="number" class="form-control" name="inputCapacidad" id="inputCapacidad"
                          value="{{ vivienda.capacidad }}">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="card card-plain">
                  <div class="card-header">
                    <h5 class="card-title">Localizaci&oacute;n</h5>
                  </div>
                  <div class="card-body">
                    <div class=row>
                      <div class="col-md-6">
                        <div class="form-group">
                          <div class="col-sm-10">
                            Pa&iacute;s <input type="text" class="form-control" name="inputPais" id="inputPais"
                              value="{{ vivienda.localizacion.pais }}">
                          </div>
                        </div>
                        <div class="form-group">
                          <div class="col-sm-10">
                            Provincia <input type="text" class="form-control" name="inputProvincia" id="inputProvincia"
                              value="{{ vivienda.localizacion.provincia }}">
                          </div>
                        </div>
                        <div class="form-group">
                          <div class="col-sm-10">
                            Municipio <input type="text" class="form-control" name="inputMunicipio" id="inputMunicipio"
                              value="{{ vivienda.localizacion.municipio }}">
                          </div>
                        </div>
                        <div class="form-group">
                          <div class="col-sm-10">
                            C&oacute;digo Postal <input type="text" class="form-control" name="inputCodigoPostal"
                              id="inputCodigoPostal" value="{{ vivienda.localizacion.cp }}">
                          </div>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form-group">
                          <div class="col-sm-10">
                            Calle <input type="text" class="form-control" name="inputCalle" id="inputCalle"
                              value="{{ vivienda.localizacion.calle }}">
                          </div>
                        </div>
                        <div class="form-group">
                          <div class="col-sm-10">
                            N&uacute;mero <input type="text" class="form-control" name="inputNumero" id="inputNumero"
                              value="{{ vivienda.localizacion.numero }}">
                          </div>
                        </div>
                        <div class="form-group">
                          <div class="col-sm-10">
                            N&uacute;mero de Bloque <input type="text" class="form-control" name="inputNumeroBloque"
                              id="inputNumeroBloque" value="{{ vivienda.localizacion.numeroBloque }}">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                </div>
              </div>
            </div>
            <div class="row text-center">
              <div class="col">
                <div class="form-group">
                  <button type="submit" value="submit" class="btn btn-warning m-4 w-25" style="width: 200px; font-size: large;">Actualizar</button>
                  <a class="btn btn-danger w-25"
                    href="/viviendas/delete/{{vivienda.id}}/propietario"
                    rel="nofollow" style="width: 200px; font-size: large;">Eliminar</a>
                </div>
              </div>

            </div>
          </form>
        </div>

      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-12">
      <div class="card">
        <div class="card-body">
          <h4>Fotos</h4><br />
          <div class="col text-center">
            {% for url in vivienda.fotos %}

            {% if (loop.index-1)%3 == 0 %}
            <div class="row text-center">
              <div class="col m-4 grow text-center" style="min-width: 300px;">
                <img src="{{ url }}" alt="{{ vivienda.nombre }}" height="auto" width="300px" />
                <div class="card-body">
                  <a class="btn btn-danger" href="/viviendas/{{vivienda.id}}/imagen/{{ loop.index-1 }}/delete"
                    onclick="alert('Foto eliminada con éxito');" rel="nofollow"><img
                      src="/static/assets/img/trash-can-solid.svg" width="20px" height="20px"></a>
                </div>
              </div>
              {% endif %}

              {% if (loop.index-1)%3 == 2 %}
              <div class="col m-4 grow text-center" style="min-width: 300px;">
                <img src="{{ url }}" alt="{{ vivienda.nombre }}" height="auto" width="300px" />
                <div class="card-body">
                  <a class="btn btn-danger" href="/viviendas/{{vivienda.id}}/imagen/{{ loop.index-1 }}/delete"
                    onclick="alert('Foto eliminada con éxito');" rel="nofollow"><img
                      src="/static/assets/img/trash-can-solid.svg" width="20px" height="20px"></a>
                </div>
              </div>
            </div>
            {% endif %}

            {% if (loop.index-1)%3 == 1 %}
            <div class="col m-4 grow text-center" style="min-width: 300px;">
              <img src="{{ url }}" alt="{{ vivienda.nombre }}" height="auto" width="300px" />
              <div class="card-body">
                <a class="btn btn-danger" href="/viviendas/{{vivienda.id}}/imagen/{{ loop.index-1 }}/delete"
                  onclick="alert('Foto eliminada con éxito');" rel="nofollow"><img
                    src="/static/assets/img/trash-can-solid.svg" width="20px" height="20px"></a>
              </div>
            </div>
            {% endif %}

            {% endfor %}

          </div>
          <br/>
          <button id="upload_widget" class="cloudinary-button" style="width: 25%; font-size: large;">
            Subir foto
          </button>
        </div>
      </div>
    </div>
  </div>
  {% endblock content %}

  <!-- Specific Page JS goes HERE  -->
  {% block javascripts %}

  <script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>

  <script type="text/javascript">
    const cloudName = "canallcc";
      const uploadPreset = "ml_default";

    const myWidget = cloudinary.createUploadWidget(
      {
        cloudName: cloudName,
        uploadPreset: uploadPreset,
        sources: [
          "local",
          "url"
        ],
        googleApiKey: "<image_search_google_api_key>",
        showAdvancedOptions: false,
        cropping: false,
        multiple: false,
        defaultSource: "local",
        styles: {
          palette: {
            window: "#ffffff",
            sourceBg: "#f4f4f5",
            windowBorder: "#90a0b3",
            tabIcon: "#000000",
            inactiveTabIcon: "#555a5f",
            menuIcons: "#555a5f",
            link: "#0433ff",
            action: "#339933",
            inProgress: "#0433ff",
            complete: "#339933",
            error: "#cc0000",
            textDark: "#000000",
            textLight: "#fcfffd"
          },
          fonts: {
            default: null,
            "sans-serif": {
              url: null,
              active: true
            }
          }
        }
      },
      (error, result) => {
        if (!error && result && result.event === "success") {
          url = window.location.href.split("/");
          id = url[url.length - 1];

          fetch('/viviendas/' + id + '/imagen/', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(result.info.secure_url)
          })
          location.reload()
        }
      }
    );

    document.getElementById("upload_widget").addEventListener(
      "click",
      function () {
        myWidget.open();
      },
      false
    );
  </script>

  <script type="text/javascript">
    $(document).ready(function () {
      $('#Btn').click(function () {
        // url of the data that is to be delete
        var ajxReq = $.ajax('http://time.jsontest.com', {
          type: 'DELETE'
        });
        ajxReq.success(function (data, status, jqXhr) {
          $("p").append("Request is Success.");
        });
      });
    });
  </script>

  <script type="text/javascript">
    function doConfirm() {
      console.log("alerta");
      window.alert("Foto eliminada con éxito");
    }
  </script>
  {% endblock javascripts %}